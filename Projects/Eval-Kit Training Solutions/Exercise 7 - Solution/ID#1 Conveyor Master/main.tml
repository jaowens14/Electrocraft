//This file is automatically generated by MotionPRO Suite
//DO NOT MODIFY THIS FILE; your changes will be overwritten

// Exercise 7 - Conveyor Master
//
// This Axis runs the Empty Tube Supply conveyor.
// 
//Operation:
//    gConveyorCtrl = 0x00       Conveyor OFF
//    gConveyorCtrl = 0x01       Conveyor ON
//    gConveyorCrtl = 0x10       Conveyor in position
  int gConveyorCtrl; // Define integer variable gConveyorCtrl

  int gTubeFeedCtrl; // Define integer variable gTubeFeedCtrl

  int gTubeFillCtrl; // Define integer variable gTubeFillCtrl

  int gMasterCtrl; // Define integer variable gMasterCtrl

// End of user variable definition
  gConveyorCtrl = 0;

  gTubeFeedCtrl = 0;

  gTubeFillCtrl = 0;

  gMasterCtrl = 0;

// End of Network user variable initialization
  int Temp; // Define integer variable Temp

// End of user variable definition
  Temp = 0;

// End of user variable initialization
  SLAVEID = 4;
  SGM; //Enable Master in Electronic Gearing mode
  SRB OSR, 0x7FFF, 0x0000; //Send Position Feedback
  [4]{MPOS0 = 1;}
  UPD; //execute immediate
  SETSYNC 25L; //Send synchronization messages every 20[ms]

MainLoop: //Define label MainLoop

  Temp = gConveyorCtrl;

  SRB Temp, 0x1, 0x0; //Set Temp using AND mask 0x0001 and OR mask 0x0000

  GOTO MainLoopEnd, Temp, EQ; //Branch to MainLoopEnd if Temp == 0

StartConveyor: //Define label StartConveyor

  GOTO Fast, gMasterCtrl, NEQ; //Branch to Fast if gMasterCtrl != 0

Slow: //Define label Slow

  //Position profile
  CACC = 0.0407;//acceleration rate = 100[rad/s^2]
  CSPD = 13.3333;//slew speed = 250[rpm]
  CPOS = 40000L;//position command = 10[rot]
  CPR; //position command is relative
  MODE PP;
  TUM1; //set Target Update Mode 1
  UPD; // execute immediate
  !MC; WAIT!; // wait for completion

  GOTO StartConveyorEnd; //Branch to StartConveyorEnd

Fast: //Define label Fast

  //Position profile
  CACC = 0.4074;//acceleration rate = 1000[rad/s^2]
  CSPD = 40.;//slew speed = 750[rpm]
  CPOS = 40000L;//position command = 10[rot]
  CPR; //position command is relative
  MODE PP;
  TUM1; //set Target Update Mode 1
  UPD; // execute immediate
  !MC; WAIT!; // wait for completion

  GOTO StartConveyorEnd; //Branch to StartConveyorEnd

StartConveyorEnd: //Define label StartConveyorEnd

  SRB Temp, 0x0, 0x10; //Set Temp using AND mask 0x0000 and OR mask 0x0010

  gConveyorCtrl = Temp;

  [255]gConveyorCtrl = Temp; //Send the local variable Temp to variable gConveyorCtrl of axis/group 255

  GOTO MainLoop; //Branch to MainLoop

MainLoopEnd: //Define label MainLoopEnd

  GOTO MainLoop; //Branch to MainLoop

// End of Main program loop
// End of program
