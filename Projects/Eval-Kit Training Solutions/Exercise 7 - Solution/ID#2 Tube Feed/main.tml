//This file is automatically generated by MotionPRO Suite
//DO NOT MODIFY THIS FILE; your changes will be overwritten

// Exercise #7 - Tube Feed Axis


  int gConveyorCtrl; // Define integer variable gConveyorCtrl

  int gTubeFeedCtrl; // Define integer variable gTubeFeedCtrl

  int gTubeFillCtrl; // Define integer variable gTubeFillCtrl

  int gMasterCtrl; // Define integer variable gMasterCtrl

// End of user variable definition
  gConveyorCtrl = 0;

  gTubeFeedCtrl = 0;

  gMasterCtrl = 0;

// End of Network user variable initialization
  int Temp; // Define integer variable Temp

// End of Network variable definition
  Temp = 0;

// End of Network variable initialization
MotionLoop: //Define label MotionLoop

OutMoveTrig: //Define label OutMoveTrig

  Temp = gTubeFeedCtrl;

  SRB Temp, 0x1, 0x0; //Set Temp using AND mask 0x0001 and OR mask 0x0000

  GOTO OutMoveTrig, Temp, EQ; //Branch to OutMoveTrig if Temp == 0

  GOTO FastMotionLoop, gMasterCtrl, NEQ; //Branch to FastMotionLoop if gMasterCtrl != 0

SlowMotionLoop: //Define label SlowMotionLoop

  //Position profile
  CACC = 0.163;//acceleration rate = 400[rad/s^2]
  CSPD = 21.3333;//slew speed = 400[rpm]
  CPOS = 12000L;//position command = 3[rot]
  CPR; //position command is relative
  MODE PP;
  TUM1; //set Target Update Mode 1
  UPD; // execute immediate
  !MC; WAIT!; // wait for completion

  OUT(0) = 0x0000; //Set outputs 0 according with corresponding bits from 0x0000

  SRB Temp, 0x0, 0x10; //Set Temp using AND mask 0x0000 and OR mask 0x0010

  gTubeFeedCtrl = Temp;

  [255]gTubeFeedCtrl = Temp; //Send the local variable Temp to variable gTubeFeedCtrl of axis/group 255

ReturnMoveTrigS: //Define label ReturnMoveTrigS

  Temp = gTubeFeedCtrl;

  SRB Temp, 0x100, 0x0; //Set Temp using AND mask 0x0100 and OR mask 0x0000

  GOTO ReturnMoveTrigS, Temp, EQ; //Branch to ReturnMoveTrigS if Temp == 0

  OUT(0) = 0x0001; //Set outputs 0 according with corresponding bits from 0x0001

  SRB Temp, 0x0, 0x0; //Set Temp using AND mask 0x0000 and OR mask 0x0000

  gTubeFeedCtrl = Temp;

  [255]gTubeFeedCtrl = Temp; //Send the local variable Temp to variable gTubeFeedCtrl of axis/group 255

  TJERK = 254L; // jerk = 1e+003[rad/s^3]
  CACC = 0.0815; // acceleration rate = 200[rad/s^2]
  CSPD = 10.6667; // slew speed = 200[rpm]
  CPOS = -12000L; // position command = -3[rot]
  CPR; // position command is relative
  MODE PSC;
  SRB ACR, 0xFFFE, 0x0000; // Stop using a S-curve profile
  UPD; // execute immediate
  !MC; WAIT!; // wait for completion

  SRB Temp, 0x0, 0x1000; //Set Temp using AND mask 0x0000 and OR mask 0x1000

  gTubeFeedCtrl = Temp;

  [255]gTubeFeedCtrl = Temp; //Send the local variable Temp to variable gTubeFeedCtrl of axis/group 255

  GOTO MotionLoop; //Branch to MotionLoop

// End of Slow MotionLoop
FastMotionLoop: //Define label FastMotionLoop

  //Position profile
  CACC = 0.4074;//acceleration rate = 1000[rad/s^2]
  CSPD = 32.;//slew speed = 600[rpm]
  CPOS = 12000L;//position command = 3[rot]
  CPR; //position command is relative
  MODE PP;
  TUM1; //set Target Update Mode 1
  UPD; // execute immediate
  !MC; WAIT!; // wait for completion

  OUT(0) = 0x0000; //Set outputs 0 according with corresponding bits from 0x0000

  SRB Temp, 0x0, 0x10; //Set Temp using AND mask 0x0000 and OR mask 0x0010

  gTubeFeedCtrl = Temp;

  [255]gTubeFeedCtrl = Temp; //Send the local variable Temp to variable gTubeFeedCtrl of axis/group 255

ReturnMoveTrigF: //Define label ReturnMoveTrigF

  Temp = gTubeFeedCtrl;

  SRB Temp, 0x100, 0x0; //Set Temp using AND mask 0x0100 and OR mask 0x0000

  GOTO ReturnMoveTrigF, Temp, EQ; //Branch to ReturnMoveTrigF if Temp == 0

  OUT(0) = 0x0001; //Set outputs 0 according with corresponding bits from 0x0001

  SRB Temp, 0x0, 0x0; //Set Temp using AND mask 0x0000 and OR mask 0x0000

  gTubeFeedCtrl = Temp;

  [255]gTubeFeedCtrl = Temp; //Send the local variable Temp to variable gTubeFeedCtrl of axis/group 255

  TJERK = 417L; // jerk = 3e+003[rad/s^3]
  CACC = 0.4074; // acceleration rate = 1000[rad/s^2]
  CSPD = 26.6667; // slew speed = 500[rpm]
  CPOS = -12000L; // position command = -3[rot]
  CPR; // position command is relative
  MODE PSC;
  SRB ACR, 0xFFFE, 0x0000; // Stop using a S-curve profile
  UPD; // execute immediate
  !MC; WAIT!; // wait for completion

  SRB Temp, 0x0, 0x1000; //Set Temp using AND mask 0x0000 and OR mask 0x1000

  gTubeFeedCtrl = Temp;

  [255]gTubeFeedCtrl = Temp; //Send the local variable Temp to variable gTubeFeedCtrl of axis/group 255

  GOTO MotionLoop; //Branch to MotionLoop

// End of Fast MotionLoop
// End of program
