//This file is automatically generated by MotionPRO Suite
//DO NOT MODIFY THIS FILE; your changes will be overwritten

// Exercise 7 - Multi-axis machine control
//
//

  int gConveyorCtrl; // Define integer variable gConveyorCtrl

  int gTubeFeedCtrl; // Define integer variable gTubeFeedCtrl

  int gTubeFillCtrl; // Define integer variable gTubeFillCtrl

  int gMasterCtrl; // Define integer variable gMasterCtrl

// End of user variable definition
  gConveyorCtrl = 0;

  gTubeFeedCtrl = 0;

  gTubeFillCtrl = 0;

  gMasterCtrl = 0;

// End of Network user variable initialization
  int Temp; // Define integer variable Temp

// End of user variable definition
  Temp = 0;

// End of user variable initialization
WaitForStart: //Define label WaitForStart

  // Define event : When the digital input IN0 is low
  !IN#0 0;
  WAIT!; // Wait until the event occurs

MainLoop: //Define label MainLoop

  Temp = IN(1); // Set corresponding bits from Temp according with selected inputs status

  GOTO WaitForStart, Temp, EQ; //Branch to WaitForStart if Temp == 0

  Temp = IN(5); // Set corresponding bits from Temp according with selected inputs status

  GOTO gMasterCtrlSlow, Temp, EQ; //Branch to gMasterCtrlSlow if Temp == 0

  Temp = IN(6); // Set corresponding bits from Temp according with selected inputs status

  GOTO gMasterCtrlFast, Temp, EQ; //Branch to gMasterCtrlFast if Temp == 0

  GOTO gMasterCtrlTestEnd; //Branch to gMasterCtrlTestEnd

gMasterCtrlSlow: //Define label gMasterCtrlSlow

  SRB gMasterCtrl, 0x0, 0x0; //Set gMasterCtrl using AND mask 0x0000 and OR mask 0x0000

  [1]gMasterCtrl = gMasterCtrl; //Send the local variable gMasterCtrl to variable gMasterCtrl of axis/group 1

  [2]gMasterCtrl = gMasterCtrl; //Send the local variable gMasterCtrl to variable gMasterCtrl of axis/group 2

  [3]gMasterCtrl = gMasterCtrl; //Send the local variable gMasterCtrl to variable gMasterCtrl of axis/group 3

  GOTO gMasterCtrlTestEnd; //Branch to gMasterCtrlTestEnd

gMasterCtrlFast: //Define label gMasterCtrlFast

  SRB gMasterCtrl, 0x0, 0x1; //Set gMasterCtrl using AND mask 0x0000 and OR mask 0x0001

  [1]gMasterCtrl = gMasterCtrl; //Send the local variable gMasterCtrl to variable gMasterCtrl of axis/group 1

  [2]gMasterCtrl = gMasterCtrl; //Send the local variable gMasterCtrl to variable gMasterCtrl of axis/group 2

  [3]gMasterCtrl = gMasterCtrl; //Send the local variable gMasterCtrl to variable gMasterCtrl of axis/group 3

  GOTO gMasterCtrlTestEnd; //Branch to gMasterCtrlTestEnd

gMasterCtrlTestEnd: //Define label gMasterCtrlTestEnd

  //Position profile
  CACC = 0.0407;//acceleration rate = 100[rad/s^2]
  CSPD = 5.3333;//slew speed = 100[rpm]
  CPOS = 12000L;//position command = 3[rot]
  CPR; //position command is relative
  MODE PP;
  TUM1; //set Target Update Mode 1
  UPD; // execute immediate

  SRB gConveyorCtrl, 0x0, 0x1; //Set gConveyorCtrl using AND mask 0x0000 and OR mask 0x0001

  [1]gConveyorCtrl = gConveyorCtrl; //Send the local variable gConveyorCtrl to variable gConveyorCtrl of axis/group 1

ConveyorLoop: //Define label ConveyorLoop

  Temp = gConveyorCtrl;

  SRB Temp, 0x10, 0x0; //Set Temp using AND mask 0x0010 and OR mask 0x0000

  GOTO ConveyorLoop, Temp, EQ; //Branch to ConveyorLoop if Temp == 0

  SRB gTubeFeedCtrl, 0x0, 0x1; //Set gTubeFeedCtrl using AND mask 0x0000 and OR mask 0x0001

  [2]gTubeFeedCtrl = gTubeFeedCtrl; //Send the local variable gTubeFeedCtrl to variable gTubeFeedCtrl of axis/group 2

TFOutLoop: //Define label TFOutLoop

  Temp = gTubeFeedCtrl;

  SRB Temp, 0x10, 0x0; //Set Temp using AND mask 0x0010 and OR mask 0x0000

  GOTO TFOutLoop, Temp, EQ; //Branch to TFOutLoop if Temp == 0

  SRB gTubeFillCtrl, 0x0, 0x1; //Set gTubeFillCtrl using AND mask 0x0000 and OR mask 0x0001

  [3]gTubeFillCtrl = gTubeFillCtrl; //Send the local variable gTubeFillCtrl to variable gTubeFillCtrl of axis/group 3

TFillLoop: //Define label TFillLoop

  Temp = gTubeFillCtrl;

  SRB Temp, 0x10, 0x0; //Set Temp using AND mask 0x0010 and OR mask 0x0000

  GOTO TFillLoop, Temp, EQ; //Branch to TFillLoop if Temp == 0

  SRB gTubeFeedCtrl, 0x0, 0x100; //Set gTubeFeedCtrl using AND mask 0x0000 and OR mask 0x0100

  [2]gTubeFeedCtrl = gTubeFeedCtrl; //Send the local variable gTubeFeedCtrl to variable gTubeFeedCtrl of axis/group 2

TFRtnLoop: //Define label TFRtnLoop

  Temp = gTubeFeedCtrl;

  SRB Temp, 0x1000, 0x0; //Set Temp using AND mask 0x1000 and OR mask 0x0000

  GOTO TFRtnLoop, Temp, EQ; //Branch to TFRtnLoop if Temp == 0

  GOTO MainLoop; //Branch to MainLoop

// End of Main program loop
// End of program
