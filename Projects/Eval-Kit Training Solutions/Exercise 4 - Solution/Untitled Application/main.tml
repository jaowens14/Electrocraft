//This file is automatically generated by MotionPRO Suite
//DO NOT MODIFY THIS FILE; your changes will be overwritten

//Exercise #4 - Homing and I/O
//
// This exercise will use Homing to set an initial position and
// use inputs and outputs to control motion.
//
// Input buttons:
//    IN0 - Start "Out" motion
//    IN1 - Start "Return" motion
//
// Outputs:
//    OU0 - Turn on LED when "In Position"
//            - Turn off LED when not "In Position"
  // Select homing parameters
  CACC = 0.0407; // Acceleration rate = 100[rad/s^2]
  CDEC = 0.0407; // Deceleration rate = 100[rad/s^2]
  CSPD = 5.3333; // High speed = 100[rpm]
  HOMESPD = 0.5333; // Low speed = 10[rpm]
  HOMEPOS = 0L; // Home position = 0[rot]
  HOMECRT = 1638; // Current threshold = 1[A]
  HOMETIME = 1250U; // Current threshold time = 1[s]
  // Execute homing procedure home33
  HOMING 33;

MotionLoop: //Define label MotionLoop

  // Define event : When the digital input IN0 is low
  !IN#0 0;
  WAIT!; // Wait until the event occurs

  //Position profile
  CACC = 0.2037;//acceleration rate = 500[rad/s^2]
  CSPD = 26.6667;//slew speed = 500[rpm]
  CPOS = 12000L;//position command = 3[rot]
  CPR; //position command is relative
  MODE PP;
  TUM1; //set Target Update Mode 1
  UPD; // execute immediate
  !MC; WAIT!; // wait for completion

  OUT(0) = 0x0000; //Set outputs 0 according with corresponding bits from 0x0000

  // Define event : When the digital input IN1 is low
  !IN#1 0;
  WAIT!; // Wait until the event occurs

  OUT(0) = 0x0001; //Set outputs 0 according with corresponding bits from 0x0001

  TJERK = 668L; // jerk = 93.6268[rad/s^3]
  CACC = 0.0204; // acceleration rate = 50[rad/s^2]
  CSPD = 2.6667; // slew speed = 50[rpm]
  CPOS = -12000L; // position command = -3[rot]
  CPR; // position command is relative
  MODE PSC;
  SRB ACR, 0xFFFE, 0x0000; // Stop using a S-curve profile
  UPD; // execute immediate
  !MC; WAIT!; // wait for completion

  GOTO MotionLoop; //Branch to MotionLoop

// End of MotionLoop
  SRB ICR, 0x8FFF, 0x0001; //Set/Reset Bits of Interrupt Control Register

